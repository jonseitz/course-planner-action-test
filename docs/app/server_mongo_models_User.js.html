<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>server/mongo/models/User.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-routes_app.html">routes/app</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-UserSchema.html">UserSchema</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-UserSchema.html#.addNew">addNew</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-UserSchema.html#.getAll">getAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-UserSchema.html#.getOneByHUID">getOneByHUID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-UserSchema.html#.getOneById">getOneById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-UserSchema.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-UserSchema.html#update">update</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#LogColor">LogColor</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#LogLevel">LogLevel</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">server/mongo/models/User.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Schema } from "mongoose";

/** Mongoose Schema for Users
 * @module     UserSchema
 * @requires   mongoose
 */

/**
 * A data object that defines a user of the system.
 * @typedef  {Object}                   UserData
 * @memberof module:UserSchema
 * @property {?string}                  [_id]
 * @property {string}                   HUID
 * @property {string}                   firstName
 * @property {string}                   lastName
 * @property {AccessLevel}   accessLevel
 * @property {Object}                   [settings]
 */

/**
 * Enum for user access levels.
 * @inner
 * @enum          {string}
 * @memberof      module:UserSchema
 */
const AccessLevel = {
  READ_ONLY: "Read-Only",
  PRIVILEGED: "Privileged",
  ADMIN: "Admin"
};
let accessLevels = [];
for (let key of Object.keys(AccessLevel)) {
  accessLevels.push(AccessLevel[key]);
}

/**
 * The Schema for a User.
 * @const
 * @memberof  module:UserSchema
 */
export const UserSchema = new Schema(
  {
    HUID: { type: String, index: { unique: true } },
    firstName: { type: String, required: true },
    lastName: { type: String, required: true },
    email: { type: String, required: true },
    accessLevel: { type: String, enum: accessLevels, default: accessLevels[0] },
    settings: {}
  },
  {
    timestamps: true,
    collection: "users"
  }
);

/**
 * Creates a new user with the given data and returns a Promise
 * @static
 * @async
 * @function  addNew
 * @memberof  module:UserSchema
 * @param     {UserData}   data   The user to be added to the database
 * @return    {Promise&lt;UserData>} The mongo object for the saved user
 * @throws    {ValidationError}   If Permission is invalid
 * @throws    {MongoError}        If HUID is already in use
 * @throws    {Error}             If anything else goes wrong
 */

UserSchema.statics.addNew = async function(data) {
  try {
    let user = new this(data);
    return await user.save();
  } catch (err) {
    if (err.code === 11000) {
      throw new Error(`Error: That HUID is already in use.`);
    } else if (err.name === "ValidationError") {
      throw new Error(`Error: Invalid permission provided.`);
    } else {
      throw new Error(`Error: Could not create a new user\nError: ${err}`);
    }
  }
};

/**
 * Retrieves all of the users in the database
 * @static
 * @async
 * @function  getAll
 * @memberof  module:UserSchema
 * @return    {Promise&lt;UserData[]>}  An array containing all users in the system
 * @throws    {Error}             If data cannot be fetched
 */

UserSchema.statics.getAll = async function getAll() {
  try {
    return await this.find().exec();
  } catch (err) {
    throw new Error(`Could not fetch all user records`);
  }
};

/**
 * Retrieves the user with the given mongo ID
 * @static
 * @async
 * @function  getOneById
 * @memberof  module:UserSchema
 * @param     {string}   userId  The mongoid for the user
 * @return    {Promise&lt;UserData>} The mongo data for the user
 * @throws    {Error}    If the person cannot be found
 */
UserSchema.statics.getOneById = async function getOne(userId) {
  try {
    return await this.findById(userId).exec();
  } catch (err) {
    throw new Error(`No user record for ${userId}\nError: ${err}`);
  }
};

/**
 * Retrieves the user with the given HUID.
 * @static
 * @async
 * @function  getOneByHUID
 * @memberof  module:UserSchema
 * @param     {string}      HUID  The 8-digit HUID for the user
 * @returns   {Promise&lt;UserData>}    The MongoData for the user
 * @throws    {Error}       If the user cannot be found
 */
UserSchema.statics.getOneByHUID = async function getOneByHUID(HUID) {
  try {
    return await this.findOne({ HUID: HUID }).exec();
  } catch (err) {
    throw new Error(`No user record with HUID ${HUID}.\nError: ${err}`);
  }
};

/**
 * Updates the user instance with the given data. Only fields present
 * in the data object will be updated.
 * @instance
 * @async
 * @function  update
 * @memberof  module:UserSchema
 * @param     {UserData}  data  The new data for the user
 * @returns   {Promise&lt;UserData>} The updated user
 * @throws    {Error}     If the user cannot be updated
 */
UserSchema.methods.update = async function update(data) {
  let user = this;
  try {
    UserSchema.eachPath(prop => {
      if (prop in data &amp;&amp; user[prop] !== data[prop]) {
        user.set(prop, data[prop]);
      }
    });
    return await user.save();
  } catch (err) {
    throw new Error(`Unable to update user with id ${user.id}\nError: ${err}`);
  }
};

/**
 * Deletes the user instance.
 * @instance
 * @async
 * @function  delete
 * @memberof  module:UserSchema
 * @returns   {Promise&lt;UserData>} The deleted user's data
 * @throws    {Error}     If the user cannot be deleted
 */

UserSchema.methods.delete = async function() {
  let user = this;
  try {
    return await user.remove();
  } catch (err) {
    throw new Error(`Could not delete user with id ${user.id}.\nError: ${err}`);
  }
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Mar 06 2018 14:04:54 GMT-0500 (EST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
